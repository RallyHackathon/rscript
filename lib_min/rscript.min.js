(function(){this.rsc=this.rsc||{};this.rsc.api=this.rsc.api||{};this.rsc.global=this})();(function(){function a(a){a=rsc.util.toArray(a);return function(c){var d={};a.forEach(function(a){d[a]=c[a]});return d}}rsc.api.CustomData=function(b,c,d,e){Ext.isFunction(c)||(c=a(c));b=b.map(c);c={data:b,fields:[]};d&&(c.sorters=[{property:d,direction:e||"ASC"}]);return Ext.create("Rally.data.custom.Store",c)}})();
rsc.api.get=function(a,b,c,d){var b=b||50,a=rsc.util.toArray(a),e=a.length,f=[];a.forEach(function(c){Ext.create("Rally.data.WsapiDataStore",{model:c,fetch:!0,autoLoad:!0,pageSize:b,listeners:{load:function(b,h){var i=a.indexOf(c);f[i]=rsc.Record.wrap(h);--e;0===e&&d.apply(null,f)}}})})};Object.defineProperty(rsc.api,"HomeTag",{writable:!1,configurable:!1,enumerable:!0,value:"__rscriptHomeCard__"});Object.defineProperty(rsc,"RootId",{writable:!1,configurable:!1,enumerable:!0,value:"__rscriptRootId__"});
rsc.api.launch=function(a,b,c){var a=rsc.util.toArray(a),b=rsc.util.toArray(b),c=rsc.util.toArray(c),d=Ext.widget("container",{border:!1,renderTo:Ext.getBody(),width:"100%",height:"100%",items:[{border:!1,xtype:"panel",layout:"card",width:"100%",height:"100%",itemId:rsc.RootId,setToPage:function(a){(a=this.down("#"+a))&&this.layout.setActiveItem(a)},goHome:function(){this.setToPage(rsc.api.HomeTag)}}]});rsc.__root__=d.down("#"+rsc.RootId);var e=rsc.__root__.add({xtype:"container",width:"100%",height:"100%",
itemId:rsc.api.HomeTag});Ext.Array.each(a.concat(b),function(a){a=rsc.util.stringToHtml(a);a.resolve(e)});var f=Ext.widget("container");Ext.Array.each(c,function(a){a.resolve(f)});f.items.each(function(a){rsc.__root__.addDocked(a)});rsc.api.launch.initialTag&&(d.setToPage(rsc.api.launch.initialTag),delete rsc.api.launch.initialTag)};
rsc.api.Checkbox=function(a,b){var c=new rsc.Proxy(function(c){this.cmp=c.add({xtype:"checkbox",boxLabel:a||"",checked:!!b})});c.defineEventProperties({change:function(a){return function(c,b){a(b)}}});return c};rsc.api.Flow=function(a,b){var c=Ext.Array.toArray(arguments),d;a&&!a.isRscProxy&&!Ext.isString(a)?(d=a,c=Ext.Array.remove(c,d)):d={};d.layout="column";c=[d].concat(c);return rsc.api.Stack.apply(rsc.Stack,c)};
rsc.api.Html=function(a,b){var c=Ext.isString(a)?a:b||"",d=Ext.isNumber(a)?a:12,e=new rsc.Proxy(function(a){this.cmp=a.add({xtype:"container",html:c,style:{fontSize:d+"px"}})});Object.defineProperty(e,"html",{get:function(){return this.cmp&&this.cmp.getEl().dom.innerHTML},set:function(a){this.cmp?this.cmp.getEl().dom.innerHTML=a:c=a}});return e};
rsc.api.Link=function(a,b){var c=new rsc.Proxy(function(c){this.cmp=c.add({xtype:"rallybutton",text:a,handler:this._onClick})});c._onClick=function(a,c){c.stopEvent();-1<b.indexOf("http:")?window.location.href=b:rsc.api.goToPage(b)};return c};
rsc.api.Page=function(a,b){if(!Ext.isString(a))throw Error("page() must give the page a tag, ie page('mytag', ....)");var c=Ext.Array.toArray(arguments),c=Ext.Array.remove(c,a),d=new rsc.Proxy(function(b){if(b=b.up("#"+rsc.RootId))this.cmp=b.add({xtype:"container",width:"100%",height:"100%",itemId:a}),Ext.Array.each(c,function(a){a=rsc.util.stringToHtml(a);a.resolve(this.cmp)},this)});Object.defineProperty(d,"tag",{writable:!1,enumerable:!0,configurable:!1,value:a});d.add=function(a){Ext.isString(a)&&
(a=rsc.api.html(a));this.cmp?a.resolve(this.cmp):c.push(a)};return d};rsc.api.goToPage=function(a){var b=rsc.__root__;b?b.setToPage(a):rsc.api.launch.initialTag=a};rsc.api.AddNew=function(a,b){Ext.isString(a)&&(a=[a]);Ext.isString(b)&&(b=[b]);var c=new rsc.Proxy(function(c){this.cmp=c.add({xtype:"rallyaddnew",recordTypes:a,ignoredRequiredFields:b,showAddWithDetails:!1})});c.defineEventProperties("recordadd",{beforerecordadd:function(a){return function(c,b){a(new rsc.Record(b.record))}}});return c};
rsc.api.Cardboard=function(a,b){Ext.isString(a)&&(a=[a]);var c=new rsc.Proxy(function(c){var e={xtype:"rallycardboard",types:a,attribute:b||"ScheduleState"};this.pending.filter&&(e.storeConfig={filters:[this.pending.filter]},delete this.pending.filter);this.cmp=c.add(e)});c.surfaceMethods("refresh");Object.defineProperty(c,"filter",{set:function(a){this.cmp?this.cmp.refresh({storeConfig:{filters:[a]}}):this.pending.filter=a}});return c};
rsc.api.CurrentUser=function(){var a=Ext.clone(Rally.environment.getContext().getUser()),b=rsc.api.Html("&nbsp;"+a._refObjectName+"&nbsp;");Ext.Object.each(a,function(a,d){Ext.isFunction(d)||Object.defineProperty(b,a,{writable:!1,enumerable:!0,configurable:!1,value:d})});return b};
(function(){function a(a){var b=[];a.forEach(function(a){b.push({text:rsc.util.camelToHuman(a),dataIndex:a})});b[0]&&(b[0].flex=1);return b}function b(a,b,e,f){var g={xtype:"rallygrid"};Ext.isDefined(e)&&(g.storeConfig={filters:rsc.util.toArray(e)});b?(g.columnCfgs=b,g.autoAddAllModelFieldsAsColumns=!1):g.autoAddAllModelFieldsAsColumns=!0;g=Ext.apply(g,f);return a.add(g)}rsc.api.Grid=function(c,d,e){return new rsc.Proxy(function(f){if(Ext.isString(c)){var g=f.add({xtype:"container"});Rally.data.ModelFactory.getModel({type:c||
"UserStory",success:function(a){this.cmp=b(g,d,e,{model:a})},scope:this})}else this.cmp=b(f,a(d),e,{store:c})})}})();rsc.api.IterationCombobox=function(){var a=new rsc.Proxy(function(a){this.cmp=a.add({xtype:"rallyiterationcombobox"})});a.defineEventProperties("ready","change");a.surfaceMethodsAsProperties({getDisplayValue:"value",getValue:"ref",getQueryFromSelected:"filter"});return a};
rsc.api.Stack=function(a,b){var c=Ext.Array.toArray(arguments),d={};a&&!a.isRscProxy&&!Ext.isString(a)&&(d=a,c=Ext.Array.remove(c,d));var e=new rsc.Proxy(function(a){d=Ext.applyIf({xtype:"container"},d);this.cmp=a.add(d);Ext.Array.each(c,function(a){a=rsc.util.stringToHtml(a);a.resolve(this.cmp)},this);this.loadMask=this.pending.loadMask;delete this.pending.loadMask});e.add=function(a){a=rsc.util.stringToHtml(a);this.cmp?a.resolve(this.cmp):c.push(a)};return e};
rsc.Compiler=function(a){this.env=a||{}};rsc.Compiler.prototype={compile:function(a){if(!Ext.isString(a))throw Error("rsc.Compiler.compile, src is required");var b=[];Ext.Object.each(this.env,function(a){0!==a.indexOf("_")&&b.push(a)});b.push(a);return Function.apply(Function,b)},execute:function(a){var a=this.compile(a),b=[];Ext.Object.each(this.env,function(a,d){0!==a.indexOf("_")&&b.push(d)});return a.apply(null,b)}};
rsc.Proxy=function(a){this._resolve=a||function(){};this.pending={};Object.defineProperty(this,"isRscProxy",{value:!0,enumerable:!0,writable:!1,configurable:!1})};
rsc.Proxy.prototype={_resolvePending:function(){this.cmp&&Ext.Object.each(this.pending,function(a,b){this.cmp.on(a,b)},this);this.pending={}},resolve:function(){this._resolve.apply(this,arguments);this._resolvePending()},surfaceMethods:function(a){var b;Ext.isString(a)?(b={},b[a]=a):Ext.isArray(a)?(b={},Ext.Array.each(a,function(a){b[a]=a})):b=a;Ext.Object.each(b,function(a,b){this[b]=function(){if(this.cmp&&Ext.isFunction(this.cmp[a]))return this.cmp[a].apply(this.cmp,arguments)}},this)},surfaceMethodsAsProperties:function(a){var b;
Ext.isString(a)?(b={},b[a]=a):Ext.isArray(a)?(b={},Ext.Array.each(a,function(a){b[a]=a})):b=a;Ext.Object.each(b,function(a,b){Object.defineProperty(this,b,{get:function(){if(this.cmp&&Ext.isFunction(this.cmp[a]))return this.cmp[a].apply(this.cmp,arguments)}})},this)},defineEventProperties:function(a){var b=Ext.Array.toArray(arguments);Ext.Array.each(b,function(a){Ext.isString(a)?Object.defineProperty(this,a,{set:function(b){if(this.cmp)this.cmp.on(a,b);else this.pending[a]=b}}):Ext.Object.each(a,
function(a,b){Object.defineProperty(this,a,{set:function(c){c=b(c);if(this.cmp)this.cmp.on(a,c);else this.pending[a]=c}})},this)},this)}};rsc.Record=function(a){this._extRecord=a;this._wrap()};rsc.Record.prototype={_wrap:function(){Ext.Array.each(this._extRecord.self.getFields(),function(a){Object.defineProperty(this,a.name,{set:function(b){this._extRecord.set(a.name,b)},get:function(){return this._extRecord.get(a.name)},enumerable:!0})},this)}};
rsc.Record.wrap=function(a){var b=[],a=rsc.util.toArray(a);a.forEach(function(a){b.push(new rsc.Record(a))});return b};(function(){function a(){Rally.getContextPath=function(){return"https://test7cluster.rallydev.com/slm"}}function b(){var a=document.getElementsByTagName("script"),b;Ext.Array.each(a,function(a){if("rscript"===a.type)return b=a.innerText,!1});return b}Rally.onReady(function(){a();var c=b();c&&(new rsc.Compiler(rsc.api)).execute(c)})})();
rsc.util={toArray:function(a){return!a?[]:Ext.isArray(a)?a:[a]},stringToHtml:function(a){return Ext.isString(a)?new rsc.api.Html(a):a},camelToHuman:function(a){if(!Ext.isString(a))return a;a=a.replace(/([A-Z])/g," $1");a=a.replace(/([A-Z])\s([A-Z])/g,"$1$2");return Ext.String.trim(Ext.String.capitalize(a))}};
